<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0065)http://wiki.allegro.cc/index.php?title=Allegro_5_Tutorial/Threads -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		
		<meta http-equiv="Content-Style-Type" content="text/css">
		<meta name="generator" content="MediaWiki 1.15.1">
		<meta name="keywords" content="Allegro 5 Tutorial/Threads">
		<link rel="stylesheet" type="text/css" href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/Drafts.css">
		<link rel="shortcut icon" href="http://wiki.allegro.cc/favicon.ico">
		<link rel="search" type="application/opensearchdescription+xml" href="http://wiki.allegro.cc/opensearch_desc.php" title="Allegro Wiki (en)">
		<link rel="alternate" type="application/rss+xml" title="Allegro Wiki RSS Feed" href="http://wiki.allegro.cc/index.php?title=Special:RecentChanges&feed=rss">
		<link rel="alternate" type="application/atom+xml" title="Allegro Wiki Atom Feed" href="http://wiki.allegro.cc/index.php?title=Special:RecentChanges&feed=atom">
		<title>Allegro 5 Tutorial/Threads - Allegro Wiki</title>
		<link rel="stylesheet" href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/shared.css" type="text/css" media="screen">
		<link rel="stylesheet" href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/commonPrint.css" type="text/css" media="print">
		<link rel="stylesheet" href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/main.css" type="text/css" media="screen">
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE50Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="/skins/monobook/IE55Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="/skins/monobook/IE60Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="/skins/monobook/IE70Fixes.css?207" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/index.php" type="text/css">
		<link rel="stylesheet" href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/index(1).php" type="text/css" media="print">
		<link rel="stylesheet" href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/index(2).php" type="text/css">
		<link rel="stylesheet" href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/index(3).php" type="text/css">
		<!--[if lt IE 7]><script type="text/javascript" src="/skins/common/IEFixes.js?207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type="text/javascript" async="" src="./Allegro 5 Tutorial Threads - Allegro Wiki_files/ga.js"></script><script type="text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "/skins";
		var wgArticlePath = "/index.php?title=$1";
		var wgScriptPath = "";
		var wgScript = "/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "http://wiki.allegro.cc";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Allegro_5_Tutorial/Threads";
		var wgTitle = "Allegro 5 Tutorial/Threads";
		var wgAction = "view";
		var wgArticleId = "1344";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 6494;
		var wgVersion = "1.15.1";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="./Allegro 5 Tutorial Threads - Allegro Wiki_files/wikibits.js"><!-- wikibits js --></script><style type="text/css"></style><style type="text/css">@import "/skins/monobook/KHTMLFixes.css";</style>
		<!-- Head Scripts -->
		<script type="text/javascript" src="./Allegro 5 Tutorial Threads - Allegro Wiki_files/ajax.js"></script>
<script type="text/javascript">/*<![CDATA[*/
var wgDraftsStyleVersion = "2";

/*]]>*/</script>		<script type="text/javascript" src="./Allegro 5 Tutorial Threads - Allegro Wiki_files/Drafts.js"></script><style type="text/css">/*<![CDATA[*/
.source-c {line-height: normal;}
.source-c li, .source-c pre {
	line-height: normal; border: 0px none white;
}
/**
 * GeSHi Dynamically Generated Stylesheet
 * --------------------------------------
 * Dynamically generated stylesheet for c
 * CSS class: source-c, CSS id: 
 * GeSHi (C) 2004 - 2007 Nigel McNie, 2007 - 2008 Benny Baumann
 * (http://qbnz.com/highlighter/ and http://geshi.org/)
 * --------------------------------------
 */
.source-c .de1, .source-c .de2 {font-family: monospace; font-weight: normal; font-style: normal; margin:0; padding:0; background:inherit;}
.source-c  {font-family: monospace;}
.source-c .imp {font-weight: bold; color: red;}
.source-c li, .source-c li.li1 {font-weight: normal;}
.source-c li.li2 {font-weight: bold;}
.source-c .kw1 {color: #b1b100;}
.source-c .kw2 {color: #000000; font-weight: bold;}
.source-c .kw3 {color: #000066;}
.source-c .kw4 {color: #993333;}
.source-c .co1 {color: #666666; font-style: italic;}
.source-c .co2 {color: #339933;}
.source-c .coMULTI {color: #808080; font-style: italic;}
.source-c .es0 {color: #000099; font-weight: bold;}
.source-c .br0 {color: #009900;}
.source-c .sy0 {color: #339933;}
.source-c .st0 {color: #ff0000;}
.source-c .nu0 {color: #cc66cc;}
.source-c .me1 {color: #202020;}
.source-c .me2 {color: #202020;}
.source-c .ln-xtra, .source-c li.ln-xtra, .source-c div.ln-xtra {background-color: #ffc;}
.source-c span.xtra { display:block; }

/*]]>*/
</style>
<style type="text/css">/*<![CDATA[*/
@import "/index.php?title=MediaWiki:Geshi.css&usemsgcache=yes&action=raw&ctype=text/css&smaxage=18000";
/*]]>*/
</style>		<script type="text/javascript" src="./Allegro 5 Tutorial Threads - Allegro Wiki_files/index(4).php"><!-- site js --></script>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17252358-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

	</head>
<body class="mediawiki ltr ns-0 ns-subject page-Allegro_5_Tutorial_Threads skin-monobook">
	<div id="globalWrapper">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>

      <!-- adsense -->
      <!--div class="adsense" style="text-align:center;" -->
      <!--script type="text/javascript" --><!--
google_ad_client = "pub-7342928389312649";
/* TopBannerTextImageAwiki, 468x60, created 11/7/08 */
google_ad_slot = "4362221279";
google_ad_width = 468;
google_ad_height = 60;
//-->
<!--/script-->
<!--script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script-->
      <!-- end adsense -->
      <!--/div-->

		<div style="text-align: center;"><a href="http://itunes.apple.com/us/app/monster-rpg-2/id358610619?mt=8"><img src="./Allegro 5 Tutorial Threads - Allegro Wiki_files/monster2_banner.png"></a></div>
			<!-- google_ad_section_start -->
		<h1 id="firstHeading" class="firstHeading">Allegro 5 Tutorial/Threads</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From Allegro Wiki</h3>
			<div id="contentSub"><span class="subpages">&lt; <a href="http://wiki.allegro.cc/index.php?title=Allegro_5_Tutorial" title="Allegro 5 Tutorial">Allegro 5 Tutorial</a></span></div>
									<div id="jump-to-nav">Jump to: <a href="http://wiki.allegro.cc/index.php?title=Allegro_5_Tutorial/Threads#column-one">navigation</a>, <a href="http://wiki.allegro.cc/index.php?title=Allegro_5_Tutorial/Threads#searchInput">search</a></div>			<!-- start content -->
			<p>In this section we'll learn how to use the Allegro 5 threading interface.
</p><p>We're going to use the same bitmap created in the previous example, but instead of changing its axis with the mouse, we're going to let two threads modify them. We use the terms:
</p><p>Parent Thread: All that is running inside our <code>int main()</code> function.
</p><p>First Thread: The first thread created.
</p><p>Second Thread: The second thread created.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &lt;allegro5/allegro.h&gt;</span>
&nbsp;
class DATA<span class="br0">{</span>
&nbsp;
   public<span class="sy0">:</span>
&nbsp;
      ALLEGRO_MUTEX <span class="sy0">*</span>mutex<span class="sy0">;</span>
      ALLEGRO_COND  <span class="sy0">*</span>cond<span class="sy0">;</span>
      <span class="kw4">float</span>          posiX<span class="sy0">;</span>
      <span class="kw4">float</span>          posiY<span class="sy0">;</span>
      bool           modi_X<span class="sy0">;</span>
      bool           ready<span class="sy0">;</span>
&nbsp;
   DATA<span class="br0">(</span><span class="br0">)</span> <span class="sy0">:</span> mutex<span class="br0">(</span>al_create_mutex<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">,</span>
            cond<span class="br0">(</span>al_create_cond<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">,</span>
            posiX <span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">,</span>
            posiY <span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">,</span>
            modi_X<span class="br0">(</span><span class="kw2">false</span><span class="br0">)</span><span class="sy0">,</span>
            ready <span class="br0">(</span><span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
&nbsp;
   ~DATA<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_destroy_mutex<span class="br0">(</span>mutex<span class="br0">)</span><span class="sy0">;</span>
      al_destroy_cond<span class="br0">(</span>cond<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span>
&nbsp;
<span class="br0">}</span><span class="sy0">;</span>
&nbsp;
<span class="kw4">const</span> <span class="kw4">float</span> FPS        <span class="sy0">=</span> <span class="nu0">30</span><span class="sy0">;</span>
<span class="kw4">const</span> <span class="kw4">int</span> SCREEN_W     <span class="sy0">=</span> <span class="nu0">640</span><span class="sy0">;</span>
<span class="kw4">const</span> <span class="kw4">int</span> SCREEN_H     <span class="sy0">=</span> <span class="nu0">480</span><span class="sy0">;</span>
<span class="kw4">const</span> <span class="kw4">int</span> BOUNCER_SIZE <span class="sy0">=</span> <span class="nu0">32</span><span class="sy0">;</span>
&nbsp;
<span class="kw4">static</span> <span class="kw4">void</span> <span class="sy0">*</span>Func_Thread<span class="br0">(</span>ALLEGRO_THREAD <span class="sy0">*</span>thr<span class="sy0">,</span> <span class="kw4">void</span> <span class="sy0">*</span>arg<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">(</span><span class="kw4">int</span> argc<span class="sy0">,</span> <span class="kw4">char</span> <span class="sy0">**</span>argv<span class="br0">)</span><span class="br0">{</span>
&nbsp;
   ALLEGRO_DISPLAY     <span class="sy0">*</span>display     <span class="sy0">=</span> <span class="kw2">NULL</span><span class="sy0">;</span>
   ALLEGRO_EVENT_QUEUE <span class="sy0">*</span>event_queue <span class="sy0">=</span> <span class="kw2">NULL</span><span class="sy0">;</span>
   ALLEGRO_TIMER       <span class="sy0">*</span>timer       <span class="sy0">=</span> <span class="kw2">NULL</span><span class="sy0">;</span>
   ALLEGRO_BITMAP      <span class="sy0">*</span>bouncer     <span class="sy0">=</span> <span class="kw2">NULL</span><span class="sy0">;</span>
   ALLEGRO_THREAD      <span class="sy0">*</span>thread_1    <span class="sy0">=</span> <span class="kw2">NULL</span><span class="sy0">;</span>
   ALLEGRO_THREAD      <span class="sy0">*</span>thread_2    <span class="sy0">=</span> <span class="kw2">NULL</span><span class="sy0">;</span>
&nbsp;
   bool redraw <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>
&nbsp;
   <span class="kw1">if</span><span class="br0">(</span><span class="sy0">!</span>al_init<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
      fprintf<span class="br0">(</span>stderr<span class="sy0">,</span> <span class="st0">"failed to initialize allegro!<span class="es0">\n</span>"</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">return</span> <span class="nu0">-1</span><span class="sy0">;</span>
   <span class="br0">}</span>
&nbsp;
   <span class="kw1">if</span><span class="br0">(</span><span class="sy0">!</span>al_install_mouse<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
      fprintf<span class="br0">(</span>stderr<span class="sy0">,</span> <span class="st0">"failed to initialize the mouse!<span class="es0">\n</span>"</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">return</span> <span class="nu0">-1</span><span class="sy0">;</span>
   <span class="br0">}</span>
&nbsp;
   timer <span class="sy0">=</span> al_create_timer<span class="br0">(</span><span class="nu0">1.0</span> <span class="sy0">/</span> FPS<span class="br0">)</span><span class="sy0">;</span>
   <span class="kw1">if</span><span class="br0">(</span><span class="sy0">!</span>timer<span class="br0">)</span> <span class="br0">{</span>
      fprintf<span class="br0">(</span>stderr<span class="sy0">,</span> <span class="st0">"failed to create timer!<span class="es0">\n</span>"</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">return</span> <span class="nu0">-1</span><span class="sy0">;</span>
   <span class="br0">}</span>
&nbsp;
   display <span class="sy0">=</span> al_create_display<span class="br0">(</span>SCREEN_W<span class="sy0">,</span> SCREEN_H<span class="br0">)</span><span class="sy0">;</span>
   <span class="kw1">if</span><span class="br0">(</span><span class="sy0">!</span>display<span class="br0">)</span> <span class="br0">{</span>
      fprintf<span class="br0">(</span>stderr<span class="sy0">,</span> <span class="st0">"failed to create display!<span class="es0">\n</span>"</span><span class="br0">)</span><span class="sy0">;</span>
      al_destroy_timer<span class="br0">(</span>timer<span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">return</span> <span class="nu0">-1</span><span class="sy0">;</span>
   <span class="br0">}</span>
&nbsp;
   bouncer <span class="sy0">=</span> al_create_bitmap<span class="br0">(</span>BOUNCER_SIZE<span class="sy0">,</span> BOUNCER_SIZE<span class="br0">)</span><span class="sy0">;</span>
   <span class="kw1">if</span><span class="br0">(</span><span class="sy0">!</span>bouncer<span class="br0">)</span> <span class="br0">{</span>
      fprintf<span class="br0">(</span>stderr<span class="sy0">,</span> <span class="st0">"failed to create bouncer bitmap!<span class="es0">\n</span>"</span><span class="br0">)</span><span class="sy0">;</span>
      al_destroy_display<span class="br0">(</span>display<span class="br0">)</span><span class="sy0">;</span>
      al_destroy_timer<span class="br0">(</span>timer<span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">return</span> <span class="nu0">-1</span><span class="sy0">;</span>
   <span class="br0">}</span>
&nbsp;
   al_set_target_bitmap<span class="br0">(</span>bouncer<span class="br0">)</span><span class="sy0">;</span>
   al_clear_to_color<span class="br0">(</span>al_map_rgb<span class="br0">(</span><span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">255</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
   al_set_target_bitmap<span class="br0">(</span>al_get_backbuffer<span class="br0">(</span>display<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
   event_queue <span class="sy0">=</span> al_create_event_queue<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="kw1">if</span><span class="br0">(</span><span class="sy0">!</span>event_queue<span class="br0">)</span> <span class="br0">{</span>
      fprintf<span class="br0">(</span>stderr<span class="sy0">,</span> <span class="st0">"failed to create event_queue!<span class="es0">\n</span>"</span><span class="br0">)</span><span class="sy0">;</span>
      al_destroy_bitmap<span class="br0">(</span>bouncer<span class="br0">)</span><span class="sy0">;</span>
      al_destroy_display<span class="br0">(</span>display<span class="br0">)</span><span class="sy0">;</span>
      al_destroy_timer<span class="br0">(</span>timer<span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">return</span> <span class="nu0">-1</span><span class="sy0">;</span>
   <span class="br0">}</span>
&nbsp;
   al_register_event_source<span class="br0">(</span>event_queue<span class="sy0">,</span> al_get_display_event_source<span class="br0">(</span>display<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
   al_register_event_source<span class="br0">(</span>event_queue<span class="sy0">,</span> al_get_timer_event_source<span class="br0">(</span>timer<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
   al_register_event_source<span class="br0">(</span>event_queue<span class="sy0">,</span> al_get_mouse_event_source<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
   al_clear_to_color<span class="br0">(</span>al_map_rgb<span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
   al_flip_display<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
   al_start_timer<span class="br0">(</span>timer<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   DATA data<span class="sy0">;</span>
&nbsp;
   thread_1 <span class="sy0">=</span> al_create_thread<span class="br0">(</span>Func_Thread<span class="sy0">,</span> <span class="sy0">&amp;</span>data<span class="br0">)</span><span class="sy0">;</span>
   al_start_thread<span class="br0">(</span>thread_1<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="kw1">while</span> <span class="br0">(</span><span class="sy0">!</span>data.<span class="me1">ready</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_wait_cond<span class="br0">(</span>data.<span class="me1">cond</span><span class="sy0">,</span> data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span>
   al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
   data.<span class="me1">modi_X</span> <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>
   data.<span class="me1">ready</span>  <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span>
   al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   thread_2 <span class="sy0">=</span> al_create_thread<span class="br0">(</span>Func_Thread<span class="sy0">,</span> <span class="sy0">&amp;</span>data<span class="br0">)</span><span class="sy0">;</span>
   al_start_thread<span class="br0">(</span>thread_2<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="kw1">while</span> <span class="br0">(</span><span class="sy0">!</span>data.<span class="me1">ready</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_wait_cond<span class="br0">(</span>data.<span class="me1">cond</span><span class="sy0">,</span> data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span>
   al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
&nbsp;
   <span class="kw1">while</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>
   <span class="br0">{</span>
      ALLEGRO_EVENT ev<span class="sy0">;</span>
      al_wait_for_event<span class="br0">(</span>event_queue<span class="sy0">,</span> <span class="sy0">&amp;</span>ev<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
      <span class="kw1">if</span><span class="br0">(</span>ev.<span class="me1">type</span> <span class="sy0">==</span> ALLEGRO_EVENT_TIMER<span class="br0">)</span> <span class="br0">{</span>
         redraw <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>
      <span class="br0">}</span>
      <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>ev.<span class="me1">type</span> <span class="sy0">==</span> ALLEGRO_EVENT_DISPLAY_CLOSE<span class="br0">)</span> <span class="br0">{</span>
         <span class="kw2">break</span><span class="sy0">;</span>
      <span class="br0">}</span>
      <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>ev.<span class="me1">type</span> <span class="sy0">==</span> ALLEGRO_EVENT_MOUSE_BUTTON_DOWN<span class="br0">)</span> <span class="br0">{</span>
         <span class="kw2">break</span><span class="sy0">;</span>
      <span class="br0">}</span>
      <span class="kw1">if</span><span class="br0">(</span>redraw <span class="sy0">&amp;&amp;</span> al_is_event_queue_empty<span class="br0">(</span>event_queue<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span>
         redraw <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span>
&nbsp;
         al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
         <span class="kw4">float</span> X <span class="sy0">=</span> data.<span class="me1">posiX</span><span class="sy0">;</span>
         <span class="kw4">float</span> Y <span class="sy0">=</span> data.<span class="me1">posiY</span><span class="sy0">;</span>
         al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
         al_draw_bitmap<span class="br0">(</span>bouncer<span class="sy0">,</span> X<span class="sy0">,</span> Y<span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
         al_flip_display<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
      <span class="br0">}</span>
   <span class="br0">}</span>
   al_destroy_thread<span class="br0">(</span>thread_1<span class="br0">)</span><span class="sy0">;</span>
   al_destroy_thread<span class="br0">(</span>thread_2<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   al_destroy_bitmap<span class="br0">(</span>bouncer<span class="br0">)</span><span class="sy0">;</span>
   al_destroy_timer<span class="br0">(</span>timer<span class="br0">)</span><span class="sy0">;</span>
   al_destroy_display<span class="br0">(</span>display<span class="br0">)</span><span class="sy0">;</span>
   al_destroy_event_queue<span class="br0">(</span>event_queue<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">}</span>
&nbsp;
   <span class="kw4">static</span> <span class="kw4">void</span> <span class="sy0">*</span>Func_Thread<span class="br0">(</span>ALLEGRO_THREAD <span class="sy0">*</span>thr<span class="sy0">,</span> <span class="kw4">void</span> <span class="sy0">*</span>arg<span class="br0">)</span><span class="br0">{</span>
&nbsp;
   DATA <span class="sy0">*</span>data  <span class="sy0">=</span> <span class="br0">(</span>DATA<span class="sy0">*</span><span class="br0">)</span> arg<span class="sy0">;</span>
   <span class="kw4">float</span> num   <span class="sy0">=</span> <span class="nu0">0.1</span><span class="sy0">;</span>
&nbsp;
   al_lock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   bool modi_X <span class="sy0">=</span> data<span class="sy0">-&gt;</span>modi_X<span class="sy0">;</span>
   data<span class="sy0">-&gt;</span>ready <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>
   al_broadcast_cond<span class="br0">(</span>data<span class="sy0">-&gt;</span>cond<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   al_unlock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="kw1">while</span><span class="br0">(</span><span class="sy0">!</span>al_get_thread_should_stop<span class="br0">(</span>thr<span class="br0">)</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_lock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">if</span><span class="br0">(</span>modi_X<span class="br0">)</span>
         data<span class="sy0">-&gt;</span>posiX <span class="sy0">+=</span> num<span class="sy0">;</span>
      <span class="kw1">else</span>
         data<span class="sy0">-&gt;</span>posiY <span class="sy0">+=</span> num<span class="sy0">;</span>
      al_unlock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
      al_rest<span class="br0">(</span><span class="nu0">0.01</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span>
&nbsp;
&nbsp;
   <span class="kw1">return</span> <span class="kw2">NULL</span><span class="sy0">;</span>
   <span class="br0">}</span></pre></div></div>
<p><br>
</p>
<a name="Walk_Through" id="Walk_Through"></a><h4> <span class="mw-headline"> Walk Through </span></h4>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>&nbsp;
class DATA<span class="br0">{</span>
&nbsp;
   public<span class="sy0">:</span>
&nbsp;
      ALLEGRO_MUTEX <span class="sy0">*</span>mutex<span class="sy0">;</span>
      ALLEGRO_COND  <span class="sy0">*</span>cond<span class="sy0">;</span>
      <span class="kw4">float</span>          posiX<span class="sy0">;</span>
      <span class="kw4">float</span>          posiY<span class="sy0">;</span>
      bool           modi_X<span class="sy0">;</span>
      bool           ready<span class="sy0">;</span>
&nbsp;
   DATA<span class="br0">(</span><span class="br0">)</span> <span class="sy0">:</span> mutex<span class="br0">(</span>al_create_mutex<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">,</span>
            cond<span class="br0">(</span>al_create_cond<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">,</span>
            posiX <span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">,</span>
            posiY <span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">,</span>
            modi_X<span class="br0">(</span><span class="kw2">false</span><span class="br0">)</span><span class="sy0">,</span>
            ready <span class="br0">(</span><span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
&nbsp;
   ~DATA<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_destroy_mutex<span class="br0">(</span>mutex<span class="br0">)</span><span class="sy0">;</span>
      al_destroy_cond<span class="br0">(</span>cond<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span>
&nbsp;
<span class="br0">}</span><span class="sy0">;</span></pre></div></div>
<p>First we create a class, which is going to contain the data we want to exchange between threads.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>ALLEGRO_MUTEX <span class="sy0">*</span>mutex</pre></div></div>
<p>Here we declare a mutex (mutual exclusion). In essence it's a flag that's supposed to tell other threads to leave some data alone. You can't set it directly, though. This should become clear why.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>ALLEGRO_COND  <span class="sy0">*</span>cond<span class="sy0">;</span></pre></div></div>
<p>Here we declare a condition. It is sort of a sign that can asynchrously be picked up by other threads. Again you'll have to use functions to use it.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>      <span class="kw4">float</span>          posiX<span class="sy0">;</span>
      <span class="kw4">float</span>          posiY<span class="sy0">;</span>
      bool           modi_X<span class="sy0">;</span>
      bool           ready<span class="sy0">;</span></pre></div></div>
<p><code>posiX</code>, and <code>posiY</code> are the X, and Y coordinates of our bitmap, <code>modi_X</code> and <code>ready</code> are two flags that we're going to use later on.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>   DATA<span class="br0">(</span><span class="br0">)</span> <span class="sy0">:</span> mutex<span class="br0">(</span>al_create_mutex<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">,</span>
            cond<span class="br0">(</span>al_create_cond<span class="br0">(</span><span class="br0">)</span><span class="br0">)</span><span class="sy0">,</span>
            posiX <span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">,</span>
            posiY <span class="br0">(</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">,</span>
            modi_X<span class="br0">(</span><span class="kw2">false</span><span class="br0">)</span><span class="sy0">,</span>
            ready <span class="br0">(</span><span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span><span class="br0">}</span>
&nbsp;
   ~DATA<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_destroy_mutex<span class="br0">(</span>mutex<span class="br0">)</span><span class="sy0">;</span>
      al_destroy_cond<span class="br0">(</span>cond<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span></pre></div></div>
<p>Class's constructor, using an initialization list. Followed by the destructor. <b>Note:</b> you cannot make an instance of this object on global scope, because <code>al_create_mutex</code> and <code>al_create_cond</code> would be called before <code>al_init()</code>.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>   ALLEGRO_THREAD      <span class="sy0">*</span>thread_1    <span class="sy0">=</span> <span class="kw2">NULL</span><span class="sy0">;</span>
   ALLEGRO_THREAD      <span class="sy0">*</span>thread_2    <span class="sy0">=</span> <span class="kw2">NULL</span><span class="sy0">;</span></pre></div></div>
<p>Then inside the <code>int main()</code>function we create a pointer to an ALLEGRO_THREAD, an opaque structure representing a thread. A thread is like a program running separately.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>DATA data<span class="sy0">;</span></pre></div></div>
<p>After the Allegro initialization process, since it's using some allegro functions, we create our object <code>data</code>.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>thread_1 <span class="sy0">=</span> al_create_thread<span class="br0">(</span>Func_Thread<span class="sy0">,</span> <span class="sy0">&amp;</span>data<span class="br0">)</span><span class="sy0">;</span>
al_start_thread<span class="br0">(</span>thread_1<span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>Here we create our thread and immediately the data is sent. <code>Func_Thread</code> is a pointer to a function and <code>&amp;data</code> is the address of our recently created object. And since when a thread is created, it is initially in a suspended state, we need to call <code>al_start_thread(thread_1)</code> to begin its actual execution.
</p><p>So, you have to write your own function that matches this prototype:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre> <span class="kw4">static</span> <span class="kw4">void</span> <span class="sy0">*</span>Func_Thread<span class="br0">(</span>ALLEGRO_THREAD <span class="sy0">*</span>thr<span class="sy0">,</span> <span class="kw4">void</span> <span class="sy0">*</span>arg<span class="br0">)</span></pre></div></div>
<p>Whatever you do inside this functions is going to be running on a different thread.
</p><p>Next lines get technical, but can be seen as 1 unit:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>   al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="kw1">while</span> <span class="br0">(</span><span class="sy0">!</span>data.<span class="me1">ready</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_wait_cond<span class="br0">(</span>data.<span class="me1">cond</span><span class="sy0">,</span> data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span>
   al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>Firstly, we lock the mutex, this is how we tell Allegro that one of our many threads is going to use a shared resource. An analogy would be shouting "it's my turn now!". If this thread is the first one to shout, it gets the mutex. If another thread has locked the mutex first, this thread will have to wait until that particular thread unlocks it. <code>while (!data.ready){</code> First of all, we need to check out if the flag ready is true, because in case it is, we don't need to wait for any condition, since for some reason the second thread previously created was faster than the parent thread and it's ready. In case ready isn't true
<code>al_wait_cond</code> will unlock the previously locked mutex and pauses this thread until the condition is signaled. The function will return when cond is signaled, acquiring the lock on the mutex in the process. Finally since <code>al_wait_cond</code> acquired the mutex again, we need to call <code>al_unlock_mutex(data.mutex)</code> to unlock the mutex. 
</p><p>al_wait_cond can return for other reasons other than the condition becoming true (e.g. the process was signalled). If multiple threads are blocked on the condition variable, the condition may no longer be true by the time the second and later threads are unblocked. Remember not to unlock the mutex prematurely.
</p><p>Now you should understand the reason a <code>while</code> loop was put around <code>al_wait_cond</code>; and a variable named <code>ready</code> was put into the <code>DATA</code> class.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>&nbsp;
   al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
   data.<span class="me1">modi_X</span> <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>       
   data.<span class="me1">ready</span>  <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span>      
   al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   thread_2 <span class="sy0">=</span> al_create_thread<span class="br0">(</span>Func_Thread<span class="sy0">,</span> <span class="sy0">&amp;</span>data<span class="br0">)</span><span class="sy0">;</span>
   al_start_thread<span class="br0">(</span>thread_2<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
   <span class="kw1">while</span> <span class="br0">(</span><span class="sy0">!</span>data.<span class="me1">ready</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_wait_cond<span class="br0">(</span>data.<span class="me1">cond</span><span class="sy0">,</span> data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span>
   al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>When we come to this point its because our first thread is already done. Now we're going to create and start our second thread, so first we lock the mutex, and change the flag <code>modi_X</code> to true, the first thread received this flag as false so the first thread will be changing the Y axis of the bitmap, and the second thread, since it will receive it as true, will change the X axis. We also set our ready flag to false again since we need to do the same process we did with the first thread.
</p><p>After that, we proceed to create our second thread, as you can see we're using the same function (<code>Func_Thread</code>), for that reason we changed the flag <code>modi_X</code> to true otherwise we could create another thread function which changes the X value, but we would need to rewrite all the code again just to change a little bit of the code and that is not a good practice.
</p><p>After starting the second thread we need wait until is done, so we do the same we did with the first one. Now before we move on, let's see what it's doing the <code>Func_Thread</code> function.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>&nbsp;
&nbsp;
<span class="kw4">static</span> <span class="kw4">void</span> <span class="sy0">*</span>Func_Thread<span class="br0">(</span>ALLEGRO_THREAD <span class="sy0">*</span>thr<span class="sy0">,</span> <span class="kw4">void</span> <span class="sy0">*</span>arg<span class="br0">)</span><span class="br0">{</span>
&nbsp;
   DATA <span class="sy0">*</span>data  <span class="sy0">=</span> <span class="br0">(</span>DATA<span class="sy0">*</span><span class="br0">)</span> arg<span class="sy0">;</span>
   <span class="kw4">float</span> num   <span class="sy0">=</span> <span class="nu0">0.1</span><span class="sy0">;</span>
&nbsp;
   al_lock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   bool modi_X <span class="sy0">=</span> data<span class="sy0">-&gt;</span>modi_X<span class="sy0">;</span>
   data<span class="sy0">-&gt;</span>ready <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span>
   al_broadcast_cond<span class="br0">(</span>data<span class="sy0">-&gt;</span>cond<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   al_unlock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="kw1">while</span><span class="br0">(</span><span class="sy0">!</span>al_get_thread_should_stop<span class="br0">(</span>thr<span class="br0">)</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_lock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">if</span><span class="br0">(</span>modi_X<span class="br0">)</span>
         data<span class="sy0">-&gt;</span>posiX <span class="sy0">+=</span> num<span class="sy0">;</span>
      <span class="kw1">else</span>
         data<span class="sy0">-&gt;</span>posiY <span class="sy0">+=</span> num<span class="sy0">;</span>
      al_unlock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
      al_rest<span class="br0">(</span><span class="nu0">0.01</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span>
&nbsp;
&nbsp;
   <span class="kw1">return</span> <span class="kw2">NULL</span><span class="sy0">;</span>
   <span class="br0">}</span></pre></div></div>
<p>The data you sent using <code>al_create_thread()</code> is received by this function as a void pointer data type <code>(void *arg)</code>. So the first thing we need to do inside here is convert our object back to a DATA datatype, which is our original class. 
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre> DATA <span class="sy0">*</span>data  <span class="sy0">=</span> <span class="br0">(</span>DATA<span class="sy0">*</span><span class="br0">)</span> arg<span class="sy0">;</span></pre></div></div>
<p>With some typecasting it's done. Remember that data now it's a pointer to a DATA object so we'll use <code>data-&gt;example</code> instead of <code>data.example</code>.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre> <span class="kw4">float</span> num   <span class="sy0">=</span> <span class="nu0">0.1</span><span class="sy0">;</span></pre></div></div>
<p>This is the value we're going to add to our X or Y axis.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre> al_lock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>Again, we lock the mutex since we're going to use shared resources.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre> bool modi_X <span class="sy0">=</span> data<span class="sy0">-&gt;</span>modi_X<span class="sy0">;</span></pre></div></div>
<p>So, here we're creating a bool variable , and assigning it a value. As you can see, when we created our DATA object, this value is initialized as false, so the <code>bool modi_X</code> variable of this thread, if it's the first thread created, is going to be false. We're doing this because we need to tell the first thread to modified the X value and the second thread to modified the Y value, so the thread which receive <code>modi_X</code> (Modify X) as true, is going to do exactly that, modified the X Axi, and the thread which receive <code>modi_X</code> as false, is going to modified the Y axis.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre> data<span class="sy0">-&gt;</span>ready <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span></pre></div></div>
<p>This is the second flag of our data object, we need to use this, because our parent thread needs to wait until we have assigned the <code>modi_X</code> value. Since we're working with threads we can never assume the order or speed in which two things in parallel happen. So this flag along with the cond struct, allow us to tell our parent thread, when it can move on.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>al_broadcast_cond<span class="br0">(</span>data<span class="sy0">-&gt;</span>cond<span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>After assigning the threads modi_X to false, we change the ready flag to true, to tell to the parent thread that it doesn't need to wait, because the thread is ready, but in case it's waiting, it'll be waiting for this cond, so we also broadcast our condition so it can move on, with this line:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre> al_unlock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>Finally we unlock our mutex to tell Allegro that we're not going to be using the data object anymore so other threads can start using it.
</p><p>Ok, we need to go back to our parent thread, and make a little review:
</p><p><br>
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><ol start="0"><li class="li1"><pre class="de1">   thread_1 <span class="sy0">=</span> al_create_thread<span class="br0">(</span>Func_Thread<span class="sy0">,</span> <span class="sy0">&amp;</span>data<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">   al_start_thread<span class="br0">(</span>thread_1<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">&nbsp;</pre></li><li class="li1"><pre class="de1">   al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li2"><pre class="de2">   <span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span>data.<span class="me1">ready</span><span class="br0">)</span></pre></li><li class="li1"><pre class="de1">&nbsp;</pre></li><li class="li1"><pre class="de1">      al_wait_cond<span class="br0">(</span>data.<span class="me1">cond</span><span class="sy0">,</span> data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">&nbsp;</pre></li><li class="li1"><pre class="de1">   al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li2"><pre class="de2">&nbsp;</pre></li><li class="li1"><pre class="de1">   al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">   data.<span class="me1">modi_X</span> <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">   data.<span class="me1">ready</span>  <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">   al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li2"><pre class="de2">&nbsp;</pre></li><li class="li1"><pre class="de1">   thread_2 <span class="sy0">=</span> al_create_thread<span class="br0">(</span>Func_Thread<span class="sy0">,</span> <span class="sy0">&amp;</span>data<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">   al_start_thread<span class="br0">(</span>thread_2<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">&nbsp;</pre></li><li class="li1"><pre class="de1">   al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li2"><pre class="de2">   <span class="kw1">if</span> <span class="br0">(</span><span class="sy0">!</span>data.<span class="me1">ready</span><span class="br0">)</span></pre></li><li class="li1"><pre class="de1">&nbsp;</pre></li><li class="li1"><pre class="de1">      al_wait_cond<span class="br0">(</span>data.<span class="me1">cond</span><span class="sy0">,</span> data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">&nbsp;</pre></li><li class="li1"><pre class="de1">   al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li></ol></div></div>
<a name="Quick_Review" id="Quick_Review"></a><h4> <span class="mw-headline"> Quick Review </span></h4>
<ul><li> In line 0 we create the thread.
</li><li> In line 1 we start the thread.
</li><li> in line 3 we lock our mutex because we're going to check if <code>ready</code> it's true
</li><li> In case it is not true that means our second thread for some reason hasn't initialized its <code>modi_X</code>  bool variable, so we need to wait.
</li><li> In line 6 we start waiting.
</li><li> Ok our first thread has broadcast the conditional that means he is ready.
</li><li> In line 8 we unlock the mutex because we're not going to use it anymore.
</li><li> In line 10 we lock the mutex again, we need to change our variables because we're about to create another thread, and if we don't change the flags the second thread would be a complete mess.
</li><li> In line 11 we change our <code>modi_X</code> variable to true, that way our second thread is going to modify the X value of our bitmap.
</li><li> In line 12 we change back our ready variable to false again, because now we need to do the same with the second thread, we need to know when it's ready.
</li><li> In line 13 we unlock everything again.
</li></ul>
<p>And the next lines do everything again, but for the second thread.
</p>
<a name="Two_Threads_Running" id="Two_Threads_Running"></a><h4> <span class="mw-headline"> Two Threads Running </span></h4>
<p>At this point we have two threads running!
</p><p>Now what?
</p><p>Well those threads are changing the posi_X and posi_Y variables, so if you don't hurry up and draw the bitmap you're not going to see anything.
</p><p>But before drawing anything let's see how these threads are changing these variables:
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>   <span class="kw1">while</span><span class="br0">(</span><span class="sy0">!</span>al_get_thread_should_stop<span class="br0">(</span>thr<span class="br0">)</span><span class="br0">)</span><span class="br0">{</span>
&nbsp;
      al_lock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
      <span class="kw1">if</span><span class="br0">(</span>modi_X<span class="br0">)</span>
         data<span class="sy0">-&gt;</span>posiX <span class="sy0">+=</span> num<span class="sy0">;</span>
      <span class="kw1">else</span>
         data<span class="sy0">-&gt;</span>posiY <span class="sy0">+=</span> num<span class="sy0">;</span>
      al_unlock_mutex<span class="br0">(</span>data<span class="sy0">-&gt;</span>mutex<span class="br0">)</span><span class="sy0">;</span>
&nbsp;
      al_rest<span class="br0">(</span><span class="nu0">0.01</span><span class="br0">)</span><span class="sy0">;</span>
&nbsp;
   <span class="br0">}</span>
&nbsp;
&nbsp;
   <span class="kw1">return</span> <span class="kw2">NULL</span><span class="sy0">;</span></pre></div></div>
<p>We're back to our <code>Func_Thread()</code> function.
</p><p>After initializing some values and telling to our parent thread that we're ready, the thread enter in a loop. A very simple loop that you should understand very well. To keep it simple we're not going to create another timer but just use <code>al_rest()</code> which allow us to rest the thread some seconds, otherwise this loop would run so fast that we wouldn't be able to see our bitmap on the screen.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre><span class="kw1">while</span><span class="br0">(</span><span class="sy0">!</span>al_get_thread_should_stop<span class="br0">(</span>thr<span class="br0">)</span><span class="br0">)</span></pre></div></div>
<p>The same way this thread talked with the parent thread to tell it was ready using the <code>cond</code> variable, this function <code>al_get_thread_should_stop(thr)</code> allows the parent thread to talk with this thread, but this time we use it to tell our thread that must stop.
</p><p>If <code>al_get_thread_should_stop(thr)</code> returns true, the thread will stop, how can we make this function to return true?, we'll see it later on. <code>thr</code> it's the other value that <code>Func_Thread</code> receives. It's nothing more than a pointer to the current thread.
</p><p>So we're done with the thread function. Now let's advance in our parent thread.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><ol start="0"><li class="li1"><pre class="de1">    <span class="kw1">while</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span></pre></li><li class="li1"><pre class="de1">   <span class="br0">{</span></pre></li><li class="li1"><pre class="de1">      ALLEGRO_EVENT ev<span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">      al_wait_for_event<span class="br0">(</span>event_queue<span class="sy0">,</span> <span class="sy0">&amp;</span>ev<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li2"><pre class="de2">&nbsp;</pre></li><li class="li1"><pre class="de1">      <span class="kw1">if</span><span class="br0">(</span>ev.<span class="me1">type</span> <span class="sy0">==</span> ALLEGRO_EVENT_TIMER<span class="br0">)</span> <span class="br0">{</span></pre></li><li class="li1"><pre class="de1">         redraw <span class="sy0">=</span> <span class="kw2">true</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">      <span class="br0">}</span></pre></li><li class="li1"><pre class="de1">      <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>ev.<span class="me1">type</span> <span class="sy0">==</span> ALLEGRO_EVENT_DISPLAY_CLOSE<span class="br0">)</span> <span class="br0">{</span></pre></li><li class="li2"><pre class="de2">         <span class="kw2">break</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">      <span class="br0">}</span></pre></li><li class="li1"><pre class="de1">      <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>ev.<span class="me1">type</span> <span class="sy0">==</span> ALLEGRO_EVENT_MOUSE_BUTTON_DOWN<span class="br0">)</span> <span class="br0">{</span></pre></li><li class="li1"><pre class="de1">         <span class="kw2">break</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">      <span class="br0">}</span></pre></li><li class="li2"><pre class="de2">      <span class="kw1">if</span><span class="br0">(</span>redraw <span class="sy0">&amp;&amp;</span> al_is_event_queue_empty<span class="br0">(</span>event_queue<span class="br0">)</span><span class="br0">)</span> <span class="br0">{</span></pre></li><li class="li1"><pre class="de1">         redraw <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">&nbsp;</pre></li><li class="li1"><pre class="de1">         al_lock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">         <span class="kw4">float</span> X <span class="sy0">=</span> data.<span class="me1">posiX</span><span class="sy0">;</span></pre></li><li class="li2"><pre class="de2">         <span class="kw4">float</span> Y <span class="sy0">=</span> data.<span class="me1">posiY</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">         al_unlock_mutex<span class="br0">(</span>data.<span class="me1">mutex</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">&nbsp;</pre></li><li class="li1"><pre class="de1">         al_draw_bitmap<span class="br0">(</span>bouncer<span class="sy0">,</span> X<span class="sy0">,</span> Y<span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">&nbsp;</pre></li><li class="li2"><pre class="de2">         al_flip_display<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">      <span class="br0">}</span></pre></li><li class="li1"><pre class="de1">   <span class="br0">}</span></pre></li><li class="li1"><pre class="de1">   al_destroy_thread<span class="br0">(</span>thread_1<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">   al_destroy_thread<span class="br0">(</span>thread_2<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li2"><pre class="de2">&nbsp;</pre></li><li class="li1"><pre class="de1">   al_destroy_bitmap<span class="br0">(</span>bouncer<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">   al_destroy_timer<span class="br0">(</span>timer<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">   al_destroy_display<span class="br0">(</span>display<span class="br0">)</span><span class="sy0">;</span></pre></li><li class="li1"><pre class="de1">   al_destroy_event_queue<span class="br0">(</span>event_queue<span class="br0">)</span><span class="sy0">;</span></pre></li></ol></div></div>
<p>This shouldn't be anything new. As you can see in line 17, 18, 19 and 20, we are creating two variables and initializing them with the corresponding value, this is to clarify, that you should keep locked the mutex the less possible, <code>al_draw_bitmap()</code> take much more time than just creating and initializing two <code>float</code> variables, for that reason we're doing this.
</p>
<div dir="ltr" style="text-align: left;"><div class="source-c" style="font-family: monospace;"><pre>al_destroy_thread<span class="br0">(</span>thread_1<span class="br0">)</span><span class="sy0">;</span>
al_destroy_thread<span class="br0">(</span>thread_2<span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>And finally we're destroying the threads when we exit the program. This implicitly performs <code>al_join_thread</code> which at the same time implicitly calls <code>al_set_thread_should_stop</code> that way <code>al_get_thread_should_stop(thr)</code> will return true and the thread is going to stop.
</p><p><b>Note:</b> This is a very simple example to help you get the idea, normally you don't need to initialize first a thread then another one and so on, you can do whatever you want, though&nbsp;;).
</p>
<!-- 
NewPP limit report
Preprocessor node count: 79/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key awiki:pcache:idhash:1344-0!1!0!!en!2!edit=0 and timestamp 20131128221324 -->
<div class="printfooter">
Retrieved from "<a href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/Allegro 5 Tutorial Threads - Allegro Wiki.html">http://wiki.allegro.cc/index.php?title=Allegro_5_Tutorial/Threads</a>"</div>
						<!-- end content -->
						<div class="visualClear"></div>
		</div>
   <!-- google_ad_section_end -->
	</div>
		</div>
		<div id="column-one">
	<div id="p-cactions" class="portlet">
		<h5>Views</h5>
		<div class="pBody">
			<ul>
	
				 <li id="ca-nstab-main" class="selected"><a href="./Allegro 5 Tutorial Threads - Allegro Wiki_files/Allegro 5 Tutorial Threads - Allegro Wiki.html" title="View the content page [ctrl-alt-c]" accesskey="c">Page</a></li>
				 <li id="ca-talk" class="new"><a href="http://wiki.allegro.cc/index.php?title=Talk:Allegro_5_Tutorial/Threads&action=edit&redlink=1" title="Discussion about the content page [ctrl-alt-t]" accesskey="t">Talk</a></li>
				 <li id="ca-viewsource"><a href="http://wiki.allegro.cc/index.php?title=Allegro_5_Tutorial/Threads&action=edit" title="This page is protected.
You can view its source [ctrl-alt-e]" accesskey="e">View source</a></li>
				 <li id="ca-history"><a href="http://wiki.allegro.cc/index.php?title=Allegro_5_Tutorial/Threads&action=history" title="Past revisions of this page [ctrl-alt-h]" accesskey="h">History</a></li>			</ul>
		</div>
	</div>
	<div class="portlet" id="p-personal">
		<h5>Personal tools</h5>
		<div class="pBody">
			<ul>
				<li id="pt-login"><a href="http://wiki.allegro.cc/index.php?title=Special:UserLogin&returnto=Allegro_5_Tutorial/Threads" title="You are encouraged to log in; however, it is not mandatory [ctrl-alt-o]" accesskey="o">Log in / create account</a></li>
			</ul>
		</div>
	</div>

	<div class="portlet" id="p-logo">
		<a style="background-image: url(/pub/e/e2/Alex-logo.png);" href="http://wiki.allegro.cc/index.php?title=Main_Page" title="Visit the main page [ctrl-alt-z]" accesskey="z"></a>
	</div>
	<script type="text/javascript"> if (window.isMSIE55) fixalpha(); </script>
	<div class="generated-sidebar portlet" id="p-navigation">
		<h5>Navigation</h5>
		<div class="pBody">
			<ul>
				<li id="n-mainpage-label"><a href="http://wiki.allegro.cc/index.php?title=Main_Page">Home</a></li>
				<li id="n-allegro5"><a href="http://wiki.allegro.cc/index.php?title=Allegro_5">Allegro 5</a></li>
				<li id="n-allegro4"><a href="http://wiki.allegro.cc/index.php?title=Allegro_4">Allegro 4</a></li>
				<li id="n-gameprogramming"><a href="http://wiki.allegro.cc/index.php?title=Game_Programming">Game Programming</a></li>
				<li id="n-randompage"><a href="http://wiki.allegro.cc/index.php?title=Special:Random" title="Load a random page [ctrl-alt-x]" accesskey="x">Random page</a></li>
				<li id="n-sitesupport"><a href="http://wiki.allegro.cc/index.php?title=Allegro_Wiki:Site_support">Support the Wiki</a></li>
				<li id="n-help"><a href="http://en.wikipedia.org/wiki/Help:Contents" title="The place to find out">Help</a></li>
			</ul>
		</div>
	</div>
	<div class="generated-sidebar portlet" id="p-stuff">
		<h5>stuff</h5>
		<div class="pBody">
			<ul>
				<li id="n-recentchanges"><a href="http://wiki.allegro.cc/index.php?title=Special:RecentChanges" title="The list of recent changes in the wiki [ctrl-alt-r]" accesskey="r">Recent changes</a></li>
				<li id="n-News"><a href="http://wiki.allegro.cc/index.php?title=Allegro_Wiki:News">News</a></li>
				<li id="n-allegrocc"><a href="http://www.allegro.cc/">Allegro.cc</a></li>
			</ul>
		</div>
	</div>

	<!-- begin of banner1 -->
	<div class="generated-sidebar portlet">
	<h5>Adsense</h5>
	<div class="pBody">
	<!--a href="&amp;lt;sidebar-banner1-url&amp;gt;">
	<img width="100%" title="&amp;lt;sidebar-banner1-alttext&amp;gt;" 
		alt="&amp;lt;sidebar-banner1-alttext&amp;gt;" 
		src="&amp;lt;sidebar-banner1-imgsrc&amp;gt;" /></a-->
<script type="text/javascript"><!--
google_ad_client = "pub-7342928389312649";
/* LeftNavTextAwiki, 120x240, created 11/2/08 */
google_ad_slot = "5463067301";
google_ad_width = 120;
google_ad_height = 240;
//-->
</script>
<script type="text/javascript" src="./Allegro 5 Tutorial Threads - Allegro Wiki_files/show_ads.js">
</script>
	</div></div>
	<!-- end of banner1 -->

	<div id="p-search" class="portlet">
		<h5><label for="searchInput">Search</label></h5>
		<div id="searchBody" class="pBody">
			<form action="http://wiki.allegro.cc/index.php" id="searchform"><div>
				<input type="hidden" name="title" value="Special:Search">
				<input id="searchInput" name="search" type="text" title="Search Allegro Wiki [ctrl-alt-f]" accesskey="f" value="">
				<input type="submit" name="go" class="searchButton" id="searchGoButton" value="Go" title="Go to a page with this exact name if exists">&nbsp;
				<input type="submit" name="fulltext" class="searchButton" id="mw-searchButton" value="Search" title="Search the pages for this text">
			</div></form>
		</div>
	</div>
	<div class="portlet" id="p-tb">
		<h5>Toolbox</h5>
		<div class="pBody">
			<ul>
				<li id="t-whatlinkshere"><a href="http://wiki.allegro.cc/index.php?title=Special:WhatLinksHere/Allegro_5_Tutorial/Threads" title="List of all wiki pages that link here [ctrl-alt-j]" accesskey="j">What links here</a></li>
				<li id="t-recentchangeslinked"><a href="http://wiki.allegro.cc/index.php?title=Special:RecentChangesLinked/Allegro_5_Tutorial/Threads" title="Recent changes in pages linked from this page [ctrl-alt-k]" accesskey="k">Related changes</a></li>
<li id="t-specialpages"><a href="http://wiki.allegro.cc/index.php?title=Special:SpecialPages" title="List of all special pages [ctrl-alt-q]" accesskey="q">Special pages</a></li>
				<li id="t-print"><a href="http://wiki.allegro.cc/index.php?title=Allegro_5_Tutorial/Threads&printable=yes" rel="alternate" title="Printable version of this page [ctrl-alt-p]" accesskey="p">Printable version</a></li>				<li id="t-permalink"><a href="http://wiki.allegro.cc/index.php?title=Allegro_5_Tutorial/Threads&oldid=6494" title="Permanent link to this revision of the page">Permanent link</a></li>			</ul>
		</div>
	</div>

	<!-- begin of featured game banner -->
	<div class="generated-sidebar portlet">
		<h5>Featured Game</h5>
		<div class="pBody">
			<a href="http://itunes.apple.com/us/app/monster-rpg-2/id358610619?mt=8">
				<center>Monster RPG 2</center>
				<img width="100%" title="featured game" alt="featured game" src="./Allegro 5 Tutorial Threads - Allegro Wiki_files/featured_monster2.png">
			<center>Got an iPhone or iPod Touch? Get Game!</center></a>
		</div>
	</div>

		</div><!-- end of the left (by default at least) column -->

			<div class="visualClear"></div>
			<div id="footer">
				<div id="f-poweredbyico"><a href="http://www.mediawiki.org/"><img src="./Allegro 5 Tutorial Threads - Allegro Wiki_files/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki"></a></div>
			<ul id="f-list">
					<li id="lastmod"> This page was last modified on March 6, 2013, at 02:28.</li>
					<li id="viewcount">This page has been accessed 20,075 times.</li>
					<li id="privacy"><a href="http://wiki.allegro.cc/index.php?title=Allegro_Wiki:Privacy_policy" title="Allegro Wiki:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="http://wiki.allegro.cc/index.php?title=Allegro_Wiki:About" title="Allegro Wiki:About">About Allegro Wiki</a></li>
					<li id="disclaimer"><a href="http://wiki.allegro.cc/index.php?title=Allegro_Wiki:General_disclaimer" title="Allegro Wiki:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.146 secs. -->
</body></html>